 # Evaluating Semi-Parametric Nowcasts of COVID-19 Hospital Admissions in Germany

This repository contains the documentation, results, and code of a project evaluating the use of a semi-parametric nowcasting approach for COVID-19 hospitalisations in Germany. See the documentation for further details. This project is part of a [wider collaboration](https://covid19nowcasthub.de) assessing a range of nowcasting methods whilst providing an ensemble nowcast of COVID-19 Hospital admissions in Germany by date of positive test. This ensemble shoudl be used for any policy related work rather than the nowcasts provided in this repository. See [here](https://covid19nowcasthub.de) for more on this nowcasting collaboration.

## Citation

If making use of the results of this analysis or reusing the analysis pipeline please cite:

To cite `epinowcast` in publications use:

  Sam Abbott (2021). epinowcast: Hierarchical nowcasting of right censored
  epidemological counts, DOI: 10.5281/zenodo.5637165

A BibTeX entry for LaTeX users is

```
  @Article{,
    title = {epinowcast: Hierarchical nowcasting of right censored epidemological counts},
    author = {Sam Abbott},
    journal = {Zenodo},
    year = {2021},
    doi = {10.5281/zenodo.5637165},
  }
```

## Documentation

Document | Purpose
---|---
[Summary]() | A summary of this analysis.
[Paper draft]() | The academic paper write up of this analysis.
[Supplementary information]() | The supplementary information for the write up of this work.
[Real-time evaluation](https://epiforecasts.io/eval-germany-sp-nowcasting/real-time/) | A report visualising and evaluation real-time nowcasts.
[Analysis pipeline](https://github.com/epiforecasts/eval-germany-sp-nowcasting/blob/main/_targets.md)] | The `targets` based analysis pipeline.
[Analysis archive](https://github.com/epiforecasts/eval-germany-sp-nowcasting/releases/tag/latest) | An archived version of the `_targets` directory. Download using `get_targets_archive()`.
[Data README](https://github.com/epiforecasts/eval-germany-sp-nowcasting/blob/main/data/README.md) | Documentation for input data and summarised output from the analysis.
[News](https://github.com/epiforecasts/eval-germany-sp-nowcasting/blob/main/NEWS.md) | Dated development notes.
[epinowcast](https://epiforecasts.io/epinowcast/index.html) | The documentation for `epinowcast` the R package used to implement the models evaluated here. See this [case study](https://epiforecasts.io/epinowcast/articles/germany-age-stratified-nowcasting.html) for a simplified version of this analysis.

## Key files and folders

Folder/File | Purpose
---|---
[`writeup`](writeup/) | Summary paper and additional supplementary information as `Rmarkdown` documents.
`_targets.Rmd` | Analysis workflow for interactive use.
[`data`](data/) | Input data and summarised output generated by steps in the analysis.
[`analyses`](analyses/) | Ad-hoc analyses not part of the overarching workflow.
`.devcontainer` | Resources for reproducibility using `vscode` and `docker`.

## Dependencies

All dependencies can be installed using the following, 

```r
remotes::install_dev_deps()
```

Alternatively a docker [container](https://github.com/epiforecasts/eval-germany-sp-nowcasting/blob/main/.devcontainer/Dockerfile) and [image](https://github.com/epiforecasts/eval-germany-sp-nowcasting/pkgs/container/eval-germany-sp-nowcasting) is provided. An easy way to make use of this is using the Remote development extension of `vscode`.

## Analyses

This analysis can be recreated using the following,

```bash
bash bin/update-targets.sh
```

Run the workflow using all available workers.

```r
targets::tar_make_future(workers = future::availableCores())
```

Explore a graph of the workflow.

```r
targets::tar_visnetwork(targets_only = TRUE)
```

Watch the workflow as it runs.

```r
targets::tar_watch(targets_only = TRUE)
```

To use our archived version of the interim results (and so avoid long run times) use the following to download it,

```r
source(here::here("R", "targetss-archive.R"))
get_targets_archive()
```

To understand the workflow in more detail see [`_targets.md`](https://github.com/epiforecasts/eval-germany-sp-nowcasting/blob/main/_targets.md) and the [paper](). Reviewing the documentation for the [`targets`](https://docs.ropensci.org/targets/) package may be helpful.
